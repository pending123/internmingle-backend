generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User{
    userId              Int     @id @default(autoincrement())
    clerkId             String  @unique
    profileCompleted    Boolean?   @default(false)
    firstName           String?
    lastName            String?
    birthday            DateTime?
    bio                 String?
    gender              String?
    university          String?
    company             String?
    workPosition        String?
    workZipcode         String?
    workCity            String?
    internshipStartDate DateTime?
    internshipEndDate   DateTime?
    schoolMajor         String?
    isLookingForHousing Boolean?
    sleepSchedule       String?
    numOfRoomates       Int?
    noiseLevel          String?
    budgetRange         Int?
    instagram           String?
    linkedin            String?
    github              String?
    facebook            String?
    forums              Forum[]
    events              Event[]   

    traits            UserTrait[]  
    hobbies           UserHobby[]  
    sentMessages      Message[]    @relation("SentMessages")
    receivedMessages  Message[]    @relation("ReceivedMessages")


    @@index([clerkId])
    @@index([workCity])
    @@index([isLookingForHousing])
}

model Message {
  id            String    @id   @default(cuid())
  content       String    
  read          Boolean   @default(false)

  sender        User      @relation("SentMessages", fields: [senderId], references: [userId])
  senderId      Int 

  receiver      User      @relation("ReceivedMessages", fields: [receiverId], references: [userId])
  receiverId    Int 

  createdAt     DateTime  @default(now())
}

model Forum {
  forumId     Int      @id @default(autoincrement())
  category    String
  title       String
  textContent String
  imgUrl      String?
  createdAt   DateTime @default(now())
  upvotes     Int
  userId      Int
  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model Event {
  eventId     Int      @id @default(autoincrement())
  title       String
  category    String
  location    String
  latitude    Float?
  longitude   Float?
  placeId     String?
  placeName   String?
  dateTime    DateTime
  imgUrl      String?
  userId      Int
  description String
  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
}


model Trait{
    traitId             Int         @id @default(autoincrement())
    trait               String      @unique
    
    userTraits          UserTrait[]
}

model Hobby{
    hobbyId             Int         @id @default(autoincrement())
    hobby               String      @unique
    
    userHobbies         UserHobby[]
}

model UserTrait {
    userId      Int   
    traitId     Int      

    user        User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
    trait       Trait     @relation(fields: [traitId], references: [traitId], onDelete: Cascade)

    @@id([userId, traitId])
}

model UserHobby {
    userId      Int    
    hobbyId     Int       

    user        User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
    hobby       Hobby     @relation(fields: [hobbyId], references: [hobbyId], onDelete: Cascade)
    @@id([userId, hobbyId])
}

